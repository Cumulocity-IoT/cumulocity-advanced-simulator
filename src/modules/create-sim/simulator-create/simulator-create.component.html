
<!-- TODO: Include SmartREST -->
<div class="card" [style.background]="selectedColor">
  <div class="card-header separator">
    <ng-container *ngTemplateOutlet="header; context: templateCtx"></ng-container>
    <select class="form-control select-config" [(ngModel)]="selectedConfig" (ngModelChange)="onChangeConfig($event)">
      <option value="" disabled selected>Select Instruction Type</option>
      <option *ngFor="let first of defaultConfig">{{ first }}</option>
    </select>
    <!-- <select class="form-control select-config" [(ngModel)]="smartRestSelectedConfig" *ngIf="isSmartRestSelected">
      <option [ngValue]="!smartRestSelectedConfig" disabled>Select your Smart-Rest-Template</option>
      <option *ngFor="let first of smartRestConfig" [ngValue]="first">
        {{first.smartRestFields.msgId}}&nbsp;{{first.smartRestFields.name }}
      </option>
    </select> -->
  </div>
    <!-- <br>
    <br> -->
    
    <div *ngIf="isExpanded">
      <div class="card-block">
      <!--
      <ng-container  *ngIf="false">
        <label class="c8y-switch">
          <input type="checkbox"  [ngModel]="isSmartRestSelected" (ngModelChange)="isSmartRestSelected=!isSmartRestSelected"/>
          <span></span><em> Select from SmartREST Templates </em>
        </label>
        <div class="row">
            <div class="col-md-12">
              <div class="form-group form-group-md">
                <div class="c8y-select-wrapper" *ngIf="!isSmartRestSelected">
                  <br />
                </div>
              </div>
            </div>
        </div>
      </ng-container>
    -->

      <!-- Add all series except type SmartRest -->
      <div [ngSwitch]="selectedConfig" *ngIf="!isSmartRestSelected">
        <ng-template
          *ngFor="let form of allForms; let i = index"
          [ngSwitchCase]="defaultConfig[i]"> 

          <div class="row">
            <ng-container *ngFor="let entry of form">
              
              <div [class]="'col-xs-'+ (12 / form.length | number: '1.0-0')"  *ngIf="!entry.hidden && !(entry.type === 'switch')">
                <div class="form-group">
                  <label class="text-truncate" [title]="entry.label">{{ entry.label }}</label>
                  <div
                    class="form-group form-group-md"
                    *ngIf="entry.type === 'select'"
                  >
                    <div class="c8y-select-wrapper">
                      <select
                        class="form-control"
                        [(ngModel)]="instructionValue[entry.name]"
                      >
                        <option
                          *ngFor="let category of entry.options"
                          [value]="category.id"
                        >
                          {{ category.name }}
                        </option>
                      </select>
                    </div>
                  </div>
                  <input
                    *ngIf="entry.type === 'textField'"
                    id="{{ entry.name }}"
                    class="form-control"
                    [(ngModel)]="instructionValue[entry.name]"
                    placeholder="{{ entry.placeholder }}"
                  />
                  <!-- Custom validation for type number -->
                  <em  class="custom-validation" *ngIf="instructionValue[entry.name] && entry.isNumber && !(instructionValue[entry.name] | isNumber)">
                    <i c8yIcon="exclamation-circle validation-icon"></i>&nbsp;&nbsp;
                    <div> Please enter a number </div></em>
                 <!-- ----------------------------------- -->

                    <!-- Custom validation of type required -->
                    <em  class="custom-validation" *ngIf="selected.selected && selected.entryName === entry.name && !instructionValue[entry.name]">
                      <i c8yIcon="exclamation-circle validation-icon"></i>&nbsp;&nbsp;
                      <div> Required </div></em>
                 <!-- ------------------------------------ -->
                </div>
              </div>
            </ng-container>
            <div class="col-xs-12">
              <button
                class="btn {{ selectedSeries ? 'btn-default' : 'btn-success' }}"
                (click)="updateSeries(i)"
                style="float: right"
              >
                {{ selectedSeries ? "Update" : "Add" }} {{ defaultConfig[i] }}
              </button>
              <button
                class="btn btn-primary"
                (click)="clearSeries()"
                style="float: right; margin-right: 12px"
              >
                Reset/Clear
              </button>
              <select
                class="form-control"
                style="max-width: 200px; margin-right: 20px; float: right"
                [(ngModel)]="selectedColor" (update)="updateSeriesColor()">
                <option disabled value="#fff">
                  Select Color
                </option>

                <option
                  *ngFor="let entry of reducedColors"
                  [style.background]="entry">
                  {{ entry }}
                </option>
              </select>
              <ng-container *ngIf="selectedConfig === 'Measurement'">
              <select
                class="form-control"
                style="max-width: 200px; margin-right: 20px; float: right"
                [(ngModel)]="measurementOption">
                <option disabled value="linear">
                  Select Scaling Option
                </option>

                <option
                  *ngFor="let entry of measurementOptions">
                  {{ entry }}
                </option>
              </select>
            </ng-container>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>
</div>